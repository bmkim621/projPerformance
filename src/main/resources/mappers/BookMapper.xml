<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yi.mapper.BookMapper">
	
	<resultMap type="PerformanceVO" id="resultPerf">
		<result column="facilities_no" property="fno.facilitiesNo"/>
		<result column="total_floor" property="fno.totalFloor"/>
		<result column="zone_cnt" property="fno.zoneCnt"/>
		<result column="total_seatCnt" property="fno.totalSeatCnt"/>
		<result column="facilities_name" property="fno.facilitiesName"/>
		<result column="r_seat_cnt" property="fno.rSeatCnt"/>
		<result column="s_seat_cnt" property="fno.sSeatCnt"/>
		<result column="a_seat_cnt" property="fno.aSeatCnt"/>
		<result column="b_seat_cnt" property="fno.bSeatCnt"/>  
	</resultMap>    
	
	<!-- 공연이름으로 공연정보 가지고 오기 -->
	<select id="selectListByShowName" resultMap="resultPerf">
		select show_code, show_name, show_type, total_time, start_time, show_startdate, show_enddate, show_image_path, seat_category,
		remain_seat, r_remain_seat, s_remain_seat, a_remain_seat, b_remain_seat, facilities.facilities_no, total_floor, zone_cnt, total_seatCnt, facilities_name, r_seat_cnt, s_seat_cnt, a_seat_cnt, b_seat_cnt
		from performance left join facilities on performance.facilities_no = facilities.facilities_no
	    where show_name = #{showName}                 
	</select>  
	
	<select id="perfListAllByShowName" resultMap="resultPerf">  
		select min(show_startdate) as show_startdate, max(show_startdate) as show_enddate, show_code, show_name, show_type, total_time, 
		start_time, show_image_path, seat_category, remain_seat, r_remain_seat, s_remain_seat, a_remain_seat, b_remain_seat,   
		facilities.facilities_no, facilities_name, total_floor, total_seatCnt, zone_cnt, r_seat_cnt, s_seat_cnt, a_seat_cnt, b_seat_cnt
		from performance left join facilities on performance.facilities_no = facilities.facilities_no
		where show_name = #{showName}         
	</select>
	
	
	
	<!-- 검색 -->
	<select id="searchPerformance" resultMap="resultPerf" parameterType="hashmap">
		select show_code, show_name, show_type, total_time, start_time, show_startdate, show_enddate, show_image_path, seat_category,
		remain_seat, r_remain_seat, s_remain_seat, a_remain_seat, b_remain_seat, facilities.facilities_no, total_floor, zone_cnt, total_seatCnt, facilities_name, r_seat_cnt, s_seat_cnt, a_seat_cnt, b_seat_cnt
		from performance left join facilities on performance.facilities_no = facilities.facilities_no
		<include refid="whereSql" />
	</select>
	
	<sql id="whereSql">
		<where>
			<if test="show_name != null">        
				AND show_name = #{showName}                  
			</if>
			<if test="bookDate != null">
				and show_startdate = #{bookDate}
			</if>        
			<if test="bookTime != null">
				and start_time = #{bookTime}
			</if>	                     
		</where>
	</sql>
	
    

             





</mapper>